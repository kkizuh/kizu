**Simple Network Management Protocol (SNMP)** — это протокол прикладного уровня разработанный в 1988 году, он делает возможным обмен данными между сетевыми устройствами.

SNMP — это не продукт, а свод правил. Он определен Советом по архитектуре Интернета и является частью пакета TCP/IP. SNMP управляется и поддерживается Инженерной группой Интернета (IETF).
![[Pasted image 20250912190414.png]]

Компоненты, составляющие архитектуру SNMP:
- сетевая станция управления, включающая в себя сетевого менеджера;
- агенты;
- мастер-агенты;
- управляемые компоненты.

**Операции протокола SNMP**
![[Pasted image 20250912190437.png]]

В SNMP информация организуется структурно , основной единицей передачи данных является PDU(единица данных протокола) у каждой операции SNMP  есть свой формат PDU. Изначально протокол должен был предоставить системным администраторам инструмент для управления интернетом. Однако, гибкая архитектура SNMP позволила проводить мониторинг всех сетевых устройств и управлять ими с одной консоли. Это и стало причиной распространения SNMP.
### PDU
Менеджеры и агенты обмениваются данными через протокол UDP. Вместо него также может использоваться TCP, IPX или протокол MAC-уровня. Обмен данными основан на Protocol Data Unit (PDU).

Всего в SNMP семь PDU:
- GET — запрос менеджера NMS на получение данных c устройства.
- GETNEXT — запрос, аналогичный GET. Отличие лишь в том, что менеджер запрашивает данные, находящиеся на следующем уровне иерархии OID, в MIB.
- SET — с помощью этого запроса менеджер изменяет или присваивает устройству новые данные.
- RESPONSE — сообщение от агента, высылаемое в ответ на запрос данных.
- TRAP — уведомление о произошедшем событии или ошибке. Агент отправляет его сразу после наступления события, не дожидаясь запроса менеджера. Менеджер никак не подтверждает получение сообщения, что может стать проблемой.
- GETBULK — запрос агенту на извлечение с устройства массива данных. Это улучшенный вариант запроса GETNEXT.
- INFORM — сообщение, аналогичное TRAP, но с подтверждением получения. Агент будет отправлять уведомление, пока менеджер не подтвердит, что оно дошло.
INFORM, GETBULK — есть только во второй и третьей версиях протокола SNMP.

#### Схема PDU

| IP заголовок              | TCP/IP                                                  | TCP/IP |
| ------------------------- | ------------------------------------------------------- | ------ |
| UDP заголовок             | TCP/IP                                                  | TCP/IP |
| Версия SNMP               | v1/v2/v3                                                | PDU    |
| Строка  <br>сообщества    | Public, Private                                         | PDU    |
| Тип PDU                   | Get, GetNext, Response, Set, Trap, GetBulk,  <br>Inform | PDU    |
| ID запроса                | Идентификатор запроса                                   | PDU    |
| Статус ошибки             | 0, 1, 2, 3, 4, 5                                        | PDU    |
| Индекс ошибки             | 0, 1                                                    | PDU    |
| Связанные  <br>переменные | Одна или несколько переменных в  <br>запросе            | PDU    |

### Применение

Статусы ошибок и их описание.

- 0 — **noError —** Процесс завершен успешно.
- 1 — **tooBig —** Объект слишком большой и не помещается в сообщение Response.
- 2 — **noSuchName —** Для запросов GET и SET: запрошенная переменная не существует в базе MIB. Для запросов GETNEXT: переменная не имеет приемника в дереве MIB.
- 3 — **badValue** — Для запросов SET: сделана ошибка в синтаксисе или задано недопустимое значение.
- 4 — **readOnly —** Ошибка не определена.
- 5 — **genErr —** Прочие ошибки, например, попытка присвоить значение, превышающее пределы реализации.

По умолчанию SNMP использует UDP-порты 161 и 162. Менеджер отправляет запросы на порт 161 агента. С порта 161 агент отправляет ответ менеджеру. При отправке запроса менеджер добавляет к нему ID, а агент вставляет этот ID в ответ, чтобы менеджер мог связать свой запрос с ответом агента.

Ловушки агент высылает на порт 162 менеджера. Если используется DLTS или TLS, то агент высылает сообщения на порт 10162, а менеджер — на порт 10161. Администратор может изменить порты SNMP, используемые по умолчанию, на любые другие.

### Ловушки

Ловушка (Trap) — это важнейший способ коммуникации в SNMP. Менеджер отвечает за большое количество устройств, на многих из них может быть несколько управляемых компонентов. Агент отправляет ловушку по своей инициативе, когда необходимо сообщить менеджеру о событии. Например, ловушка может выслать отчет о перегреве машины или о том, что в тонере закончились чернила.

Получив уведомление, менеджер выбирает нужное действие, например, опрашивает агента, чтобы получить полное представление о том, что произошло. Перечень уведомлений, которые посылает ловушка:

- 0 — **coldStart** — Холодный запуск устройства.
- 1 — **warmStart** — Горячий запуск устройства.
- 2 — **linkDown** — Интерфейс отключился.
- 3 — **linkUp** — Интерфейс включился.
- 4 — **authenticationFailure** — Менеджер выслал сообщение с неверной строкой сообщества.
- 5 — **egpNeighborLoss** — Агент потерял связь с хостом по протоколу Exterior Gateway Protocol (EGP).
- 6 — **entrpriseSpecific** — Произошло событие, характерное для производителя данного устройства.

В SNMP есть два типа ловушек: Trap и Inform. Отличия между ними в том, что после получения Inform менеджер подтверждает получение ловушки. В противном случае агент будет отправлять Inform, пока не получит подтверждения. А вот после получения Trap менеджер не отправляет подтверждение. Если сообщение не дошло до менеджера, агент об этом не узнает.